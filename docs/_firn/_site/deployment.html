<html><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="" name="author" /><meta content="" name="description" /><title></title><link href="http://localhost:4000/static/css/firn_base.css" rel="stylesheet" /></head><body><main class="def-wrapper"><aside class="def-sidebar unfocused" id="sidebar"><ul class="firn-sitemap firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="http://localhost:4000/index">Home</a></li><li><a class="firn-sitemap-item--link" href="http://localhost:4000/contributing">Contibuting</a></li><li><a class="firn-sitemap-item--link" href="http://localhost:4000/community">Community</a></li><li><a class="firn-sitemap-item--link" href="http://localhost:4000/api">API</a></li><li><a class="firn-sitemap-item--link" href="http://localhost:4000/roadmap">Roadmap</a></li><li><a class="firn-sitemap-item--link" href="http://localhost:4000/configuration">Configuring FlatTrack</a></li><li><a class="firn-sitemap-item--link" href="http://localhost:4000/meta">Meta</a></li><li><a class="firn-sitemap-item--link" href="http://localhost:4000/testing">Testing</a></li><li><a class="firn-sitemap-item--link" href="http://localhost:4000/development">FlatTrack development</a></li><li><a class="firn-sitemap-item--link" href="http://localhost:4000/design-guidelines">Design guidelines</a></li><li><a class="firn-sitemap-item--link" href="http://localhost:4000/deployment">Deploying FlatTrack</a></li></ul></aside><article class="content"><div><div><section><p><span>To configure FlatTrack, please refer to the </span><a href="#configurationmd">configuration guide</a><span>.</span></p></section><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="kubernetes-(recommended)"><span class="firn-headline-text"><span>Kubernetes (recommended)</span></span></h1><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="helm"><span class="firn-headline-text"><span>Helm</span></span></h3><div class="firn-headline-section firn-headline-section-5"><h5 class="firn-headline firn-headline-5" id="configuration"><span class="firn-headline-text"><span>Configuration</span></span></h5><section><p><span>Chart values are located in </span><a class="firn-external" href="https://gitlab.com/flattrack/flattrack/-/blob/master/deployments/flattrack/values.yaml" target="_blank">../deployments/flattrack/values.yaml</a><span>.</span></p><table><tr><td><span>Parameter</span></td><td><span>Description</span></td><td><span>Default</span></td></tr><tr></tr><tr><td><span>replicaCount</span></td><td><span>FlatTrack replica Pods</span></td><td><span>1</span></td></tr><tr><td><span>image.repository</span></td><td><span>The repo where the image lives</span></td><td><span>registry.gitlab.com/flattrack/flattrack</span></td></tr><tr><td><span>image.tag</span></td><td><span>Specifies a tag of from the image to use</span></td><td><code>nil</code></td></tr><tr><td><span>image.pullPolicy</span></td><td><span>FlatTrack container pull policy</span></td><td><span>IfNotPresent</span></td></tr><tr><td><span>imagePullSecrets</span></td><td><span>References for the registry secrets to pull FlatTrack from</span></td><td><code>[]</code></td></tr><tr><td><span>nameOverride</span></td><td><span>Expand the name of the chart</span></td><td><code>""</code></td></tr><tr><td><span>fullNameOverride</span></td><td><span>Create a FQDN for the app name</span></td><td><code>""</code></td></tr><tr><td><span>podSecurityContext.readOnlyRootFilesystem</span></td><td><span>Set the rootfs as read-only</span></td><td><span>true</span></td></tr><tr><td><span>podSecurityContext.runAsUser</span></td><td><span>The user to run as</span></td><td><span>1000</span></td></tr><tr><td><span>podSecurityContext.runAsGroup</span></td><td><span>The group to run as</span></td><td><span>1000</span></td></tr><tr><td><span>podSecurityContext.allowPrivilegeEscalation</span></td><td><span>If the process in the container can become root</span></td><td><span>true</span></td></tr><tr><td><span>service.type</span></td><td><span>In way which the app is exposed</span></td><td><span>ClusterIP</span></td></tr><tr><td><span>service.port</span></td><td><span>The port to run the app on</span></td><td><span>8080</span></td></tr><tr><td><span>horizonalPodAutoscaler.enabled</span></td><td><span>If the Pods should autoscale</span></td><td><span>true</span></td></tr><tr><td><span>horizonalPodAutoscaler.minReplicas</span></td><td><span>Minimum amount of Pods</span></td><td><span>2</span></td></tr><tr><td><span>horizonalPodAutoscaler.maxReplicas</span></td><td><span>Maximum amount of Pods</span></td><td><span>5</span></td></tr><tr><td><span>horizonalPodAutoscaler.targetCPUUtilizationPercentage</span></td><td><span>How much resource should be utilized before scaling</span></td><td><span>5</span></td></tr><tr><td><span>podDisruptionBudget.enabled</span></td><td><span>define the max number of disruptions allowed</span></td><td><span>enable</span></td></tr><tr><td><span>podDisruptionBudget.minAvailable</span></td><td><span>minimum number of Pods that should always be available</span></td><td><span>2</span></td></tr><tr><td><span>podDisruptionBudget.maxUnavailable</span></td><td><span>max amount of Pods that are allowed to be unavailable</span></td><td></td></tr><tr><td><span>prometheus.enabled</span></td><td><span>enable Prometheus annotations</span></td><td><span>true</span></td></tr><tr><td><span>networkPolicy.enabled</span></td><td><span>enable networkPolicy rules</span></td><td><span>false</span></td></tr><tr><td><span>networkPolicy.ingress</span></td><td><span>configure Ingress policy rules</span></td><td><span>{}</span></td></tr><tr><td><span>networkPolicy.egress</span></td><td><span>configure Egress policy rules</span></td><td><span>{}</span></td></tr><tr><td><span>extraEnvVars</span></td><td><span>declare extra environment variables</span></td><td></td></tr><tr><td><span>postgres.enabled</span></td><td><span>use the helm chart to set the database credentials</span></td><td><span>true</span></td></tr><tr><td><span>postgres.username</span></td><td><span>the username for an existing Postgres databse</span></td><td><span>flattrack</span></td></tr><tr><td><span>postgres.password</span></td><td><span>the password for an existing Postgres databse</span></td><td><span>flattrack</span></td></tr><tr><td><span>postgres.host</span></td><td><span>the host for an existing Postgres databse</span></td><td><span>flattrack</span></td></tr><tr><td><span>postgres.database</span></td><td><span>the database for an existing Postgres databse</span></td><td><span>flattrack</span></td></tr><tr><td><span>postgres.sslmode</span></td><td><span>the sslmode for an existing Postgres databse</span></td><td><span>disable</span></td></tr><tr><td><span>smtp.enabled</span></td><td><span>enable SMTP for messages and notifications</span></td><td><span>false</span></td></tr><tr><td><span>smtp.username</span></td><td><span>SMTP username</span></td><td><code>""</code></td></tr><tr><td><span>smtp.password</span></td><td><span>SMTP password</span></td><td><code>""</code></td></tr><tr><td><span>smtp.host</span></td><td><span>SMTP host</span></td><td><code>""</code></td></tr><tr><td><span>smtp.port</span></td><td><span>SMTP port</span></td><td><code>""</code></td></tr><tr><td><span>siteURL</span></td><td><span>the URL of the site</span></td><td><code>""</code></td></tr><tr><td><span>realIPHeader</span></td><td><span>a HTTP header to use for forwarding the real IP address</span></td><td><code>""</code></td></tr><tr><td><span>labels</span></td><td><span>declare labels for all resources</span></td><td><code>{}</code></td></tr><tr><td><span>annotations</span></td><td><span>declare annotations for all resources</span></td><td><code>{}</code></td></tr><tr><td><span>ingress.enabled</span></td><td><span>create an ingress manifests</span></td><td><span>false</span></td></tr><tr><td><span>ingress.annotations</span></td><td><span>set annotations for the ingress manifest</span></td><td><code>{}</code></td></tr><tr><td><span>ingress.hosts</span></td><td><span>the hosts which the ingress endpoint should be accessed from</span></td><td></td></tr><tr><td><span>ingress.tls</span></td><td><span>references to TLS secrets</span></td><td><code>[]</code></td></tr><tr><td><span>resources.limits.cpu</span></td><td><span>max amount of CPU</span></td><td><span>250m</span></td></tr><tr><td><span>resources.limits.memory</span></td><td><span>max amount of memory</span></td><td><span>40Mi</span></td></tr><tr><td><span>resources.resources.cpu</span></td><td><span>requested amount of CPU</span></td><td><span>250m</span></td></tr><tr><td><span>resources.limits.memory</span></td><td><span>max amount of memory</span></td><td><span>40Mi</span></td></tr><tr><td><span>nodeSelector</span></td><td><span>declare the node labels for Pod scheduling</span></td><td><code>{}</code></td></tr><tr><td><span>tolerations</span></td><td><span>declare the toleration labels for Pod scheduling</span></td><td><code>[]</code></td></tr><tr><td><span>affinity</span></td><td><span>declare the affinity settings for the Pod scheduling</span></td><td><code>{}</code></td></tr></table></section></div><div class="firn-headline-section firn-headline-section-5"><h5 class="firn-headline firn-headline-5" id="installation"><span class="firn-headline-text"><span>Installation</span></span></h5><section><p><span>Create the namespace:</span></p><pre class="language-sh"><code class="language-sh">  kubectl create namespace flattrack-myflat
</code></pre><p><span>Install the release with Helm:</span></p><pre class="language-sh"><code class="language-sh">  helm install flattrack-myflat --namespace flattrack-myflat deployments/flattrack
</code></pre></section></div></div></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="docker-compose"><span class="firn-headline-text"><span>Docker-compose</span></span></h1><section><p><span>The example set up in Docker-compose for FlatTrack is located in </span><a class="firn-external" href="https://gitlab.com/flattrack/flattrack/-/blob/master/deployments/docker-compose.yml" target="_blank">../deployments/docker-compose.yml</a><span>. This configuration is not considered production-ready, but for some may be a good enough option.</span><code>Important notes</code><span>:</span></p><ul><li><p><span>the docker-compose deployment doesn't include SSL/TLS in the stack, so if you wish to deploy it you will need to add a reverse-proxy to handle SSL/TLS - this isn't something that FlatTrack implements.</span></p></li><li><p><span>ensure that the credentials are updated</span></p></li></ul><p><span>Deploy the docker-compose stack:</span></p><pre class="language-sh"><code class="language-sh">  docker-compose up -d
</code></pre></section></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="plain-ubuntu-server"><span class="firn-headline-text"><span>Plain Ubuntu server</span></span></h1><section><p><span>Set up FlatTrack on an Ubuntu 20.04 server using systemd, certbot, and nginx.
This has been tested on Ubuntu 20.04 and will very likely work on later versions.</span></p><p><span>Commands are run as root.</span></p></section><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="install-packages"><span class="firn-headline-text"><span>Install packages</span></span></h3><section><pre class="language-sh"><code class="language-sh">    apt update && apt upgrade -y
    apt install -y nginx postgresql software-properties-common build-essential

    add-apt-repository universe
    curl -L https://golang.org/dl/go1.14.6.linux-amd64.tar.gz | tar --directory /usr/local --extract --ungzip
    echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc && export PATH=$PATH:/usr/local/go/bin
    curl -sL https://deb.nodesource.com/setup_14.x | bash -
    apt update
    apt install -y certbot python3-certbot-nginx nodejs
</code></pre></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="dns"><span class="firn-headline-text"><span>DNS</span></span></h3><section><p><span>Assign a host to your VPS.</span></p><p><span>e.g:</span></p><pre class="language-example"><code class="language-example">    flattrack.mydomain.com. 443 IN A	159.89.157.114
</code></pre></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="set-up-letsencrypt-with-certbot"><span class="firn-headline-text"><span>Set up LetsEncrypt with certbot</span></span></h3><section><pre class="language-sh"><code class="language-sh">    certbot --nginx
</code></pre><p><span>Notes:</span></p><ul><li><p><span>recommended redirection of traffic to HTTPS</span></p><p><span>  #+begin_example
    Saving debug log to /var/log/letsencrypt/letsencrypt.log
    Plugins selected: Authenticator nginx, Installer nginx
    Enter email address (used for urgent renewal and security notices) (Enter 'c' to
    cancel): EMAIL@ADDRESS.COM</span></p><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><p><span>-</span></p></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p><span>    Please read the Terms of Service at
    https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must
    agree in order to register with the ACME server at
    https://acme-v02.api.letsencrypt.org/directory</span></p><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><p><span>-</span></p></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p><span>    (A)gree/(C)ancel: a</span></p><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><p><span>-</span></p></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p><span>    Would you be willing to share your email address with the Electronic Frontier
    Foundation, a founding partner of the Let's Encrypt project and the non-profit
    organization that develops Certbot? We'd like to send you email about our work
    encrypting the web, EFF news, campaigns, and ways to support digital freedom.</span></p><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><p><span>-</span></p></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p><span>    (Y)es/(N)o: n
    No names were found in your configuration files. Please enter in your domain
    name(s) (comma and/or space separated)  (Enter 'c' to cancel): flattrack.mydomain.com
    Obtaining a new certificate
    Performing the following challenges:
    http-01 challenge for flattrack.mydomain.com
    Waiting for verification...
    Cleaning up challenges
    Deploying Certificate to VirtualHost /etc/nginx/sites-enabled/default</span></p><p><span>    Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.</span></p><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><p><span>-</span></p></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p><span>    1: No redirect - Make no further changes to the webserver configuration.
    2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for
    new sites, or if you're confident your site works on HTTPS. You can undo this
    change by editing your web server's configuration.</span></p><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><p><span>-</span></p></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p><span>    Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2
    Redirecting all traffic on port 80 to ssl in /etc/nginx/sites-enabled/default</span></p><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><p><span>-</span></p></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p><span>    Congratulations! You have successfully enabled
    https://flattrack.mydomain.com</span></p><p><span>    You should test your configuration at:
    https://www.ssllabs.com/ssltest/analyze.html?d=flattrack.mydomain.com</span></p><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li><p><span>-</span></p></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p><span>    IMPORTANT NOTES:</span></p><ul><li><p><span>Congratulations! Your certificate and chain have been saved at:
       /etc/letsencrypt/live/flattrack.mydomain.com/fullchain.pem
       Your key file has been saved at:
       /etc/letsencrypt/live/flattrack.mydomain.com/privkey.pem
       Your cert will expire on 2020-09-04. To obtain a new or tweaked
       version of this certificate in the future, simply run certbot again
       with the "certonly" option. To non-interactively renew </span><strong><span>all</span></strong><span> of
       your certificates, run "certbot renew"</span></p></li><li><p><span>Your account credentials have been saved in your Certbot
       configuration directory at /etc/letsencrypt. You should make a
       secure backup of this folder now. This configuration directory will
       also contain certificates and private keys obtained by Certbot so
       making regular backups of this folder is ideal.</span></p></li><li><p><span>If you like Certbot, please consider supporting our work by:</span></p><p><span>       Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
       Donating to EFF:                    https://eff.org/donate-le</span></p></li></ul></li></ul><p><span>  #+end_example</span></p></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="create-flattrack-user"><span class="firn-headline-text"><span>Create FlatTrack user</span></span></h3><section><pre class="language-sh"><code class="language-sh">   useradd -m flattrack
</code></pre><p><span>Add a password:</span></p><pre class="language-"><code class="language-">   passwd flattrack
</code></pre></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="set-up-postgres"><span class="firn-headline-text"><span>Set up Postgres</span></span></h3><section><p><span>Create the </span><code>FlatTrack</code><span> role:</span></p><pre class="language-sh"><code class="language-sh">     su postgres -c 'createuser flattrack -s'   
</code></pre><p><span>Create the </span><code>FlatTrack</code><span> database:</span></p><pre class="language-sh"><code class="language-sh">     su postgres -c 'createdb flattrack'
</code></pre><p><span>Check that you can authenticate:</span></p><pre class="language-sh"><code class="language-sh">     su flattrack -c 'psql -c \\conninfo'
</code></pre><p><span>Change the postgres password FlatTrack user:</span></p><pre class="language-sh"><code class="language-sh">     su flattrack -c "psql -c \"ALTER USER flattrack WITH PASSWORD 'flattrack';\""
</code></pre><p><span>Note: setting </span><code>'flattrack'</code><span> to the password that you want the role to have</span></p></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="set-up-nginx"><span class="firn-headline-text"><span>Set up nginx</span></span></h3><section><p><span>Add a customized version of the following to </span><code>/etc/nginx/sites-available/default</code><span>:</span></p><pre class="language-text"><code class="language-text">    server {
      listen 443 ssl http2;
      server_name flattrack.mydomain.com;

      ssl_certificate     /etc/letsencrypt/live/flattrack.mydomain.com/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/flattrack.mydomain.com/privkey.pem;
      ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
      ssl_ciphers         HIGH:!aNULL:!MD5;
      add_header          Strict-Transport-Security "max-age=15552000";

      fastcgi_hide_header X-Powered-By;

      location / {
        proxy_pass http://localhost:8080;

        proxy_set_header X-Forwarded-Host     $host;
        proxy_set_header X-Forwarded-Server   $host;
        proxy_set_header X-Real-IP            $remote_addr;
        proxy_set_header X-Forwarded-For      $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto    $scheme;
        proxy_set_header X-Forwarded-Protocol $scheme;
        proxy_set_header X-Forwarded-Port     $server_port;
        proxy_set_header Host                 $http_host;

        proxy_redirect  off;
        proxy_buffering off;

        proxy_http_version 1.1;
        proxy_set_header Upgrade    $http_upgrade;
        proxy_set_header Connection "upgrade";
      }
    }

</code></pre><p><span>Reload nginx</span></p><pre class="language-sh"><code class="language-sh">  systemctl reload nginx
</code></pre></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="build-flattrack"><span class="firn-headline-text"><span>Build FlatTrack</span></span></h3></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="clone-flattrack"><span class="firn-headline-text"><span>Clone FlatTrack</span></span></h3><section><p><span>    Also, check a version (for stability):</span></p><pre class="language-sh"><code class="language-sh">     git clone -b 0.0.1-alpha8-2 https://gitlab.com/flattrack/flattrack /opt/flattrack
     cd $_
</code></pre></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="build-the-frontend"><span class="firn-headline-text"><span>Build the frontend</span></span></h3><section><pre class="language-sh"><code class="language-sh">      npm i
      npm run build
</code></pre></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="build-the-backend"><span class="firn-headline-text"><span>Build the backend</span></span></h3><section><pre class="language-sh"><code class="language-sh">      export CGO_ENABLED=0 GOOS=linux GOARCH="$GOARCH"

      go build \
            -a \
            -installsuffix cgo \
            -ldflags "-extldflags '-static' -s -w \
            -X gitlab.com/flattrack/flattrack/pkg/common.AppBuildVersion=$(git symbolic-ref HEAD | sed 's!refs\/heads\/!!') \
            -X gitlab.com/flattrack/flattrack/pkg/common.AppBuildHash=$(git rev-parse --short HEAD) \
            -X gitlab.com/flattrack/flattrack/pkg/common.AppBuildDate=$(date -u +%Y-%m-%d_%I:%M:%S%p) \
            -X gitlab.com/flattrack/flattrack/pkg/common.AppBuildMode=production" \
            -o flattrack \
            ./main.go
</code></pre></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="write-the-environment-settings"><span class="firn-headline-text"><span>Write the environment settings</span></span></h3><section><p><span>Install a custom environment file into </span><code>/home/flattrack/.env</code><span>:</span></p><pre class="language-sh"><code class="language-sh">  APP_DB_USER=flattrack
  APP_DB_PASSWORD=flattrack
  APP_DB_HOST=localhost
  APP_DB_DATABASE=flattrack
</code></pre></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="install-a-systemd-service"><span class="firn-headline-text"><span>Install a systemd service</span></span></h3><section><p><span>Install a customized version of the following, in </span><code>/etc/systemd/system/flattrack.service</code><span>:</span></p><pre class="language-systemd"><code class="language-systemd">     [Unit]
     Description=Collaborate with your flatmates
     After=postgresql.service
     After=nginx.service

     [Service]
     Type=simple
     ExecStart=/opt/flattrack/flattrack
     Restart=always
     User=flattrack
     Environment="APP_DB_MIGRATIONS_PATH=/opt/flattrack/migrations"
     Environment="APP_PORT=127.0.0.1:8080"
     Environment="APP_PORT_METRICS=127.0.0.1:2112"
     Environment="APP_PORT_HEALTH=127.0.0.1:8081"
     Environment="APP_DIST_FOLDER=/opt/flattrack/dist"
     Environment="APP_ENV_FILE=/home/flattrack/.env"

     [Install]
     WantedBy=default.target
</code></pre><p><span>The configuration above configures:</span></p><ul><li><p><span>ports for FlatTrack, metrics, health</span></p></li><li><p><span>the database password; update </span><code>APP_DB_PASSWORD</code><span> it isn't </span><code>flattrack</code></p></li><li><p><span>the location of the built frontend</span></p></li><li><p><span>the location of the environment variables file, it is recommended to use this file for fields like database credentials instead of placing them inside the systemd unit file</span></p></li></ul></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="start-flattrack"><span class="firn-headline-text"><span>Start FlatTrack</span></span></h3><section><pre class="language-sh"><code class="language-sh">   systemctl enable --now flattrack
</code></pre><p><span>Check if FlatTrack is running and has started successfully.</span></p><pre class="language-sh"><code class="language-sh">   systemctl status flattrack
</code></pre><p><span>Woohoo! FlatTrack should now be running. Go to the hostname assigned in the DNS stage in a web browser to access.</span></p></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="notes"><span class="firn-headline-text"><span>Notes</span></span></h3><section><ul><li><p><span>Once the frontend and backend is built, golang and nodejs is no longer needed or used (except for manual updates), so feel free to remove them</span></p></li></ul></section></div></div></div></div></article></main></body></html>